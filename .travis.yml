language: php
sudo: false
php:
- 7.3
cache:
  directories:
  - "$HOME/.composer/cache/files"
env:
- SYMFONY_VERSION="4.2.*" DB=mysql
script:
- php bin/phpunit
services:
- mysql
install:
- composer install
- cp .env.travis .env
- php bin/console doctrine:database:create --env=test
- php bin/console doctrine:schema:create --env=test
before_deploy:
- openssl aes-256-cbc -K $encrypted_3b4824445f26_key -iv $encrypted_3b4824445f26_iv
  -in deploy_key.enc -out ./deploy_key -d
- eval "$(ssh-agent -s)"
- chmod 600 ./deploy_key
- echo -e "Host 104.219.248.53\n\tStrictHostKeyChecking no\n" >> ~/.ssh/config
- ssh-add ./deploy_key
- ssh -i ./deploy_key arslvsec@104.219.248.53 -p 21098 pwd
deploy:
  provider: script
  skip_cleanup: true
  script: ssh -p21098 arslvsec@104.219.248.53 "mkdir -p /home/arslvsec/public_html/_tmp-hqCRUD"&& ssh -p21098 arslvsec@104.219.248.53 "mkdir -p /home/arslvsec/public_html/hqCRUD" && rsync -rav -e ssh --exclude='.git/' --exclude=scripts/ --exclude='.travis.yml' --delete-excluded ./ arslvsec@104.219.248.53:/home/arslvsec/public_html/_tmp-hqCRUD && ssh -p21098 arslvsec@104.219.248.53 "mv /home/arslvsec/public_html/hqCRUD /home/arslvsec/public_html/_old-hqCRUD && mv /home/arslvsec/public_html/_tmp-hqCRUD /home/arslvsec/public_html/hqCRUD" && ssh -p21098 arslvsec@104.219.248.53 "rm -rf /home/arslvsec/public_html/_old-hqCRUD"
  on:
    branch: master
